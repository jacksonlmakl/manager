#!/bin/bash
# Ensure script exits on failure
set -e

# Start the main containers
docker compose up -d
echo "Main containers started"

# Get all running container IDs
container_ids=$(docker ps -q)

# Loop through each container and execute the deploy script
for container_id in $container_ids; do
  echo "Processing container: $container_id"
  
  # Execute the deploy script in each container
  echo "Running deployment script in container $container_id"
  sudo docker exec $container_id sudo bash docker-deploy-wrapper.sh || echo "Failed to run deploy script in container $container_id"
done

echo "All containers started and deployment scripts executed"
